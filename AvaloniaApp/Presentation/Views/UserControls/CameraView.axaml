<!-- AvaloniaApp.Presentation/Views/UserControls/CameraView.xaml -->
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AvaloniaApp.Presentation.ViewModels.UserControls"
             xmlns:models="using:AvaloniaApp.Core.Models"
             xmlns:conv="using:AvaloniaApp.Presentation.Converters"
             mc:Ignorable="d"
             d:DesignWidth="1000"
             d:DesignHeight="600"
             x:Class="AvaloniaApp.Presentation.Views.UserControls.CameraView"
             x:DataType="vm:CameraViewModelTest">

    <UserControl.Resources>
        <conv:RegionColorIndexToBrushConverter x:Key="RegionIndexToBrush" />
    </UserControl.Resources>

    <Grid RowDefinitions="*,Auto" Margin="4">
        <Border Grid.Row="0" Margin="4" Background="Gray">
            <Grid>
                <!-- 1) 카메라 이미지 -->
                <Image x:Name="PreviewImage" MinWidth="548" MaxWidth="548" MinHeight="548" MaxHeight="548"
                       Source="{Binding PreviewBitmap}"
                       Stretch="Uniform" 
                       />

                <!-- 2) 이미 확정된 ROI -->
<!--                <ItemsControl ItemsSource="{Binding Regions}"
                              IsHitTestVisible="False">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.Styles>
                        <Style Selector="ItemsControl > ContentPresenter"
                               x:DataType="models:SelectionRegion">
                            <Setter Property="Canvas.Left" Value="{Binding X}" />
                            <Setter Property="Canvas.Top"  Value="{Binding Y}" />
                        </Style>
                    </ItemsControl.Styles>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="models:SelectionRegion">
                            <Grid>
                                <Rectangle Width="{Binding Width}"
                                           Height="{Binding Height}"
                                           Stroke="{Binding ColorIndex, Converter={StaticResource RegionIndexToBrush}}"
                                           StrokeThickness="1"
                                           Fill="Transparent" />
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>-->

                <!-- 3) 드래그용 Canvas -->
<!--                <Canvas x:Name="SelectionCanvas"
                        Background="Transparent"
                        IsHitTestVisible="{Binding CanDrawRegions}"
                        PointerPressed="SelectionCanvas_OnPointerPressed"
                        PointerMoved="SelectionCanvas_OnPointerMoved"
                        PointerReleased="SelectionCanvas_OnPointerReleased">

                    <Rectangle x:Name="SelectionRect"
                               Stroke="{Binding NextRegionBrush}"
                               StrokeThickness="1"
                               Fill="Transparent"
                               IsHitTestVisible="False"
                               Width="0"
                               Height="0" />
                </Canvas>-->
            </Grid>
        </Border>

        <!-- 아래 버튼/컨트롤 부분 -->
        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,8,0,8"
                    Spacing="8">

            <Button Content="Start"
                    Width="100"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    Command="{Binding StartPreviewCommand}" />

            <Button Content="Stop"
                    Width="100"
                    HorizontalContentAlignment="Center"
                    VerticalContentAlignment="Center"
                    Command="{Binding StopPreviewCommand}" />
            
            <!--<TextBlock Text="{Binding PreviewFps, StringFormat=FPS: {0:0.0}}" TextAlignment="Center"/>-->
            
            <TextBlock Text="Wavelength : "
                       Margin="16,0,4,0"
                       VerticalAlignment="Center" />

            <ComboBox Width="120"
                      Margin="4,0"
                      ItemsSource="{Binding WavelengthIndexs}"
                      SelectedItem="{Binding SelectedWavelengthIndex, Mode=TwoWay}" 
                      DisplayMemberBinding="{Binding DisplayText}"/>


            <TextBlock Text="Distance : "
                       Margin="16,0,4,0"
                       VerticalAlignment="Center" />

            <ComboBox Width="120"
                      ItemsSource="{Binding WorkingDistances}"
                      SelectedItem="{Binding SelectedWorkingDistance, Mode=TwoWay}"/>
        </StackPanel>
    </Grid>
</UserControl>

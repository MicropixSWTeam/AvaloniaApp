<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:AvaloniaApp.Presentation.ViewModels.UserControls"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="AvaloniaApp.Presentation.Views.UserControls.CameraView"
             x:DataType="vm:CameraViewModel">

    <Grid RowDefinitions="*,Auto" Margin="4">
        <Border Grid.Row="0"
                Margin="4"
                Background="Black">
            <Grid>
                <!-- 실제 카메라 이미지 -->
                <Image x:Name="CameraImage"
                       Source="{Binding DisplayImage}"
                       Stretch="Uniform" />

                <!-- 선택 사각형을 그릴 캔버스 -->
                <Canvas x:Name="SelectionCanvas"
                        Background="Transparent"
                        PointerPressed="SelectionCanvas_OnPointerPressed"
                        PointerMoved="SelectionCanvas_OnPointerMoved"
                        PointerReleased="SelectionCanvas_OnPointerReleased">

                    <Rectangle x:Name="SelectionRect"
                               Stroke="Red"
                               StrokeThickness="1"
                               Fill="#40FF0000"
                               IsHitTestVisible="False"
                               Width="0"
                               Height="0" />
                </Canvas>
            </Grid>
        </Border>

        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,8,0,8"
                    Spacing="8">

            <Button Content="Start"
                    Width="100"
                    Command="{Binding StartPreviewCommand}" 
                    VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>

            <Button Content="Stop"
                    Width="100"
                    Command="{Binding StopPreviewCommand}" 
                    VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>
            <Button Content="Save Image"
                    Width="100"
                    Command="{Binding SaveDisplayImageCommand}"
                    IsEnabled="{Binding IsStop}"/>
            <TextBlock Text="Idx : "
                       Margin="16,0,4,0"
                       VerticalAlignment="Center" />

            <Button Content="&lt;"
                    Width="30"
                    Command="{Binding PrevIndexCommand}" 
                    VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>

            <TextBox Width="20"
                     Margin="4,0"
                     Text="{Binding SelectedCropIndexText,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" 
                     VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>

            <Button Content="&gt;"
                    Width="30"
                    Command="{Binding NextIndexCommand}" 
                    VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>

            <CheckBox Content="Normalize"
                      Margin="16,0,4,0"
                      IsChecked="{Binding NormalizePreviewEnabled, Mode=TwoWay}"
                      IsEnabled="{Binding IsStop}"
                      VerticalAlignment="Center" 
                      VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>

            <TextBlock Text="Target Intensity:"
                       Margin="16,0,4,0"
                       VerticalAlignment="Center" />

            <TextBox Width="40"
                     Text="{Binding TargetIntensity,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" 
                     VerticalContentAlignment="Center" HorizontalContentAlignment="Center"/>

            <TextBlock Text="Distance : "
                       Margin="16,0,4,0"
                       VerticalAlignment="Center" />

            <ComboBox Width="80"
                      ItemsSource="{Binding AvailableDistances}"
                      SelectedItem="{Binding SelectedDistance, Mode=TwoWay}" 
                      IsEnabled="{Binding IsStop}"/>
        </StackPanel>
    </Grid>
</UserControl>
